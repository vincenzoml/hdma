%!TEX root=ndma.tex
\newcommand{\eq}[1]{=_{#1}}

Given two \hdmas{} $\autom_i = (Q_i,\weight{-}_i,q_0^i,\rho_0^i,\trarrow_i,\acc_i)$, $i=1,2$, we now define their \emph{synchronized product} $\autom_1 \syncp \autom_2$. Some notation: given two disjoint sets of names $S_1,S_2 \subseteq \names$,we write $Eq(S_1,S_2)$ for the set of all equivalence relations $R \subseteq (S_1 \cup S_2) \times (S_1 \cup S_2)$ induced by equations of the form $x_1 \eq{R} x_2$, for $x_i \in S_i$. 

\begin{definition}[Synchronized product of \hdmas]
 $\autom_1 \syncp \autom_2$ is an automaton $(Q,\weight{-},q_0,\rho_0,\trarrow_i,\acc)$ defined as follows
\begin{itemize}
	\item $Q := \bigcup_{q_1 \in S_1,q_2 \in S_2} \{(q_1,q_2)\} \times Eq(\weight{q_1}_1,\weight{q_2}_2)$;
	%
	\item $\weight{(q_1,q_2,R)} := (\weight{q_1} \amalg \weight{q_2})_{/R}$, for $(q_1,q_2,R) \in Q$;
	%
	\item $q_0 := (q_0^1,q_0^2,R_0)$, where $R_0$ is given by
	\[
		\inferrule
		{ \rho_0^1(x_1) = \rho_0^2(x_2) \\ x_1 \in \weight{q_0^1},x_2 \in \weight{q_0^2}}
		{ x_1 \eq{R_0} x_2 }
	\]
	\item $\rho_0([x]_{R_0}) = \rho_0^i (x)$ whenever $x \in \weight{q_0^i}$, $i \in \{1,2\}$; 
	%(well-defined by definition of $R_0$);
	%
	\item $(q_1,q_2,R) \htr{l}{\sigma} (q_1',q_2',R')$ whenever $q_1 \htrind{l_1}{\sigma_1}{1} q_1'$, $q_2 \htrind{l_2}{\sigma_2}{2} q_2'$, and one of the following holds: 
	\begin{itemize}
		%	
		\item if $l_1,l_2 \in \names$ then $l_1 =_R l_2$, $l = [l_1]_R$, and $R'$ is the smallest equivalence relation generated by
		\[
			\inferrule*[left=Eq]
			{ x_1 \eq{R} x_2 \\ x_1 \in \Im(\sigma_1),x_2 \in \Im(\sigma_2)}
			{ \sigma_1^{-1}(x_1) \eq{R'} \sigma_2^{-1}(x_2) }
		\]
		%
		\item if $l_1 \in \names$ and $l_2 = \star $ then $l = [l_1]_R$, $[l_1]_R = \{l_1\}$ and $R'$ is generated by \textsc{Eq} and
		\[
			\inferrule
			{ l_1 \in \Im(\sigma_1) }
			{ \sigma_1^{-1}(l_1) \eq{R'} \sigma_2^{-1}(\star) }
		\]
		\item if $l_1,l_2 = \star$ then $l=\star$ and $R'$ is generated by \textsc{Eq} and
		\[
			\sigma_1^{-1}(\star) \eq{R'} \sigma_2^{-1}(\star)
		\]
	\end{itemize}
	and $\sigma([x]_{R'}) = [\sigma_i(x)]_R$ whenever $x \in \weight{q_i'}$, for $i \in \{1,2\}$.
%		\[
%			\sigma([x]_{R'}) = 
%			\begin{cases}
%				[\sigma_1(x)]_R & x \in \weight{q_1'} \\
%				[\sigma_2(x)]_R & x \in \weight{q_2'}
%			\end{cases}
%		\]
\end{itemize}
\end{definition}

\begin{proposition}
Let $((q_1,q_2,R),\rho) \tr{a} ((q_1',q_2',R'),\rho')$ be an edge in the configuration graph of $\autom_1 \syncp \autom_2$. Then $(q_1,\rho_1) \trind{a}{1} (q_1',\rho_1')$ and $(q_2,\rho_2) \trind{a}{2} (q_2',\rho_2')$ are edges in the configuration graphs of $\autom_1$ and $\autom_2$, respectively.
\end{proposition}

\begin{proposition}
$\syncp$ is associative.
\end{proposition}
